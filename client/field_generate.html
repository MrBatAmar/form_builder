<template name="generateField">
    <div class="field {{ state$isPreview }}">
        {{# if compare type "===" "subForm" }}
            {{> afArrayField name=name field=this template="custom" }}
        {{ else }}
            {{# if compare type "===" "seperator" }}
                <div class="seperator">
                    <span>{{ text }}</span>
                </div>
            {{ else }}
                {{> afFormGroup name=name template="custom" }}
            {{/ if }}
        {{/ if }}
    </div>
</template>

<template name="afFormGroup_custom">
  <div class="{{#if afFieldIsInvalid name=this.name}}has-error{{/if}} {{afFormGroupClass}}" data-required={{required}} {{afFormGroupAtts}}>
    {{#unless skipLabel}}
        <label {{bsFieldLabelAtts}}>{{#if this.labelText}}{{this.labelText}}{{else}}{{afFieldLabelText name=this.name}}{{/if}}</label>
    {{/unless}}

    <div class="control">
        {{> afFieldInput this.afFieldInputAtts}}
    </div>

    <span class="help-block">{{{afFieldMessage name=this.name}}}</span>
  </div>
</template>

<template name="afArrayField_custom">
    <div class="sub-form">
        <div class="title">{{afFieldLabelText name=atts.name}}</div>

        {{#if afFieldIsInvalid name=atts.name}}
            <div class="autoform-array-field-error">
                {{{afFieldMessage name=atts.name}}}
            </div>
        {{/if}}

        {{#afEachArrayItem name=atts.name minCount=atts.minCount maxCount=atts.maxCount}}
        <div class="autoform-array-item">

            {{# each getSubFields ../atts.field this }}
                {{> generateField }}
            {{/ each }}

            {{#if afArrayFieldHasMoreThanMinimum name=../atts.name minCount=../atts.minCount maxCount=../atts.maxCount}}
                <button type="button" class="autoform-remove-item">Remove</button>
            {{/if}}
        </div>
        {{/afEachArrayItem}}

        <div class="clearfix"></div>

        {{#if afArrayFieldHasLessThanMaximum name=atts.name minCount=atts.minCount maxCount=atts.maxCount}}
            <button type="button" class="autoform-add-item" data-autoform-field="{{atts.name}}" data-autoform-minCount="{{atts.minCount}}" data-autoform-maxCount="{{atts.maxCount}}">Add</button>
        {{/if}}
    </div>
</template>
